#!/bin/bash

while true; do
  clear
  echo -e "\n\033[1;35m   Netrum Lite Node - Node9x Auto Installer\033[0m"
  echo "   ========================================"
  echo "1) Install Netrum Lite Node    4) Start Mining              7) Update CLI"
  echo "2) Create New Wallet           5) View Mining Log           8) Delete Node"
  echo "3) Import Wallet               6) Claim Rewards             9) Exit"
  echo ""
  read -p "Select an action [1-9]: " choice

  case $choice in
    1)
      echo -e "\n\033[1;32mStarting Netrum Lite Node setup...\033[0m"
      git clone https://github.com/NetrumLabs/netrum-lite-node.git
      cd netrum-lite-node || exit
      sudo apt update && sudo apt install -y curl bc jq speedtest-cli nodejs npm

      if ! node -v | grep -q "v20"; then
        echo -e "\n\033[1;33mInstalling Node.js v20...\033[0m"
        curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
        sudo apt install -y nodejs
      fi

      npm install
      npm link

      echo -e "\n\033[1;32m✅ Netrum CLI installed successfully!\033[0m"
      echo -e "To run: \033[1;33mnetrum\033[0m"
      read -p "Press Enter to return to menu..."
      ;;

    2)
      echo -e "\n\033[1;34mEnter wallet name:\033[0m"
      read WALLET_NAME
      echo export WALLET_NAME=${WALLET_NAME} >> ~/.bash_profile
      source ~/.bash_profile
      netrum-new-wallet --name "$WALLET_NAME"
      echo -e "\n\033[1;31m⚠️  Save your mnemonic phrase securely!\033[0m"
      read -p "Press Enter to return to menu..."
      ;;

    3)
      netrum-import-wallet
      read -p "Press Enter to return to menu..."
      ;;

    4)
      netrum-mining
      read -p "Press Enter to return to menu..."
      ;;

    5)
      netrum-mining-log
      read -p "Press Enter to return to menu..."
      ;;

    6)
      netrum-claim
      read -p "Press Enter to return to menu..."
      ;;

    7)
      netrum-update
      read -p "Press Enter to return to menu..."
      ;;

    8)
      echo -e "\n\033[1;31m⚠️  WARNING: This will remove Netrum CLI and all wallet data.\033[0m"
      read -p "Are you sure you want to delete everything? (y/N): " confirm
      if [[ "$confirm" == "y" || "$confirm" == "Y" ]]; then
        sudo rm -rf ~/netrum-lite-node ~/.config/netrum-lite-node /usr/local/bin/netrum
        echo -e "\n\033[1;32mNetrum Lite Node deleted successfully.\033[0m"
      else
        echo -e "\n\033[1;33mAborted.\033[0m"
      fi
      read -p "Press Enter to return to menu..."
      ;;

    9)
      echo -e "\n\033[1;35mGoodbye!\033[0m"
      break
      ;;

    *)
      echo -e "\n\033[1;31mInvalid option. Please select 1-9.\033[0m"
      read -p "Press Enter to try again..."
      ;;
  esac
done
